# π® Server-Client κ²μ„ λ¨λ‹ν„°λ§ μ‹μ¤ν… λ¶„μ„ λ¬Έμ„

## π“‹ λ©μ°¨
1. [ν”„λ΅μ νΈ κ°μ”](#ν”„λ΅μ νΈ-κ°μ”)
2. [ν”„λ΅μ νΈ κµ¬μ΅°](#ν”„λ΅μ νΈ-κµ¬μ΅°)
3. [ν•µμ‹¬ μ»΄ν¬λ„νΈ λ¶„μ„](#ν•µμ‹¬-μ»΄ν¬λ„νΈ-λ¶„μ„)
4. [λ°μ΄ν„°λ² μ΄μ¤ κµ¬μ΅°](#λ°μ΄ν„°λ² μ΄μ¤-κµ¬μ΅°)
5. [μ‹μ¤ν… μ›ν¬ν”λ΅μ°](#μ‹μ¤ν…-μ›ν¬ν”λ΅μ°)
6. [μ»΄ν¬λ„νΈ κ΄€κ³„λ„](#μ»΄ν¬λ„νΈ-κ΄€κ³„λ„)
7. [ν„μ¬ λ¬Έμ μ  λ° κ°μ„ μ‚¬ν•­](#ν„μ¬-λ¬Έμ μ -λ°-κ°μ„ μ‚¬ν•­)

---

## π― ν”„λ΅μ νΈ κ°μ”

μ΄ ν”„λ΅μ νΈλ” **λ‹¤μ¤‘ κ²μ„ ν΄λΌμ΄μ–ΈνΈ λ¨λ‹ν„°λ§ μ‹μ¤ν…**μΌλ΅, μ—¬λ¬ VM ν™κ²½μ—μ„ μ‹¤ν–‰λλ” κ²μ„ λ΄‡λ“¤μ μƒνƒλ¥Ό μ‹¤μ‹κ°„μΌλ΅ μμ§‘ν•κ³  μ›Ή λ€μ‹λ³΄λ“λ¥Ό ν†µν•΄ λ¨λ‹ν„°λ§ν•λ” μ‹μ¤ν…μ…λ‹λ‹¤.

### μ£Όμ” λ©μ 
- κ²μ„ ν΄λΌμ΄μ–ΈνΈλ“¤μ μ‹¤μ‹κ°„ μƒνƒ λ¨λ‹ν„°λ§ (λ‹¤μ΄μ•„, μ„λ²„, λ©”μ‹μ§€ λ“±)
- μ¤‘μ•™ μ§‘μ¤‘μ‹ κ΄€λ¦¬ λ° λ…λ Ή μ „μ†΅
- μ›Ή κΈ°λ° λ€μ‹λ³΄λ“λ¥Ό ν†µν• μ‹κ°μ  λ¨λ‹ν„°λ§
- νμ¤ν† λ¦¬ λ°μ΄ν„° λ¶„μ„ λ° νΈλ λ“ μ¶”μ 

---

## π“ ν”„λ΅μ νΈ κµ¬μ΅°

```
server_client_project1/
β”β”€β”€ π“‚ server/                    # μ„λ²„ μ»΄ν¬λ„νΈ
β”‚   β”β”€β”€ server.py                 # λ©”μΈ TCP μ„λ²„ (ν¬νΈ 5050)
β”‚   β”β”€β”€ server_send.py           # ν΄λΌμ΄μ–ΈνΈ λ…λ Ή μ†΅μ‹  λ¨λ“
β”‚   β”β”€β”€ settings.json            # μ„λ²„ μ„¤μ • νμΌ
β”‚   β”β”€β”€ client_status.db         # SQLite λ°μ΄ν„°λ² μ΄μ¤
β”‚   β””β”€β”€ server_log.txt           # μ„λ²„ λ΅κ·Έ νμΌ
β”‚
β”β”€β”€ π“‚ client/                    # ν΄λΌμ΄μ–ΈνΈ μ»΄ν¬λ„νΈ
β”‚   β”β”€β”€ client.py                # λ©”μΈ ν΄λΌμ΄μ–ΈνΈ (v2.3.6-stealth)
β”‚   β”β”€β”€ config.json              # ν΄λΌμ΄μ–ΈνΈ μ„¤μ • νμΌ
β”‚   β”β”€β”€ client_debug.log         # ν΄λΌμ΄μ–ΈνΈ λ΅κ·Έ
β”‚   β”β”€β”€ MessageCache.txt         # μμ‹  λ©”μ‹μ§€ μΊμ‹
β”‚   β”β”€β”€ VERSION.txt              # λ²„μ „ μ •λ³΄
β”‚   β””β”€β”€ π“‚ dist/client.exe       # PyInstaller λΉλ“ κ²°κ³Ό
β”‚
β”β”€β”€ π“‚ board/                     # μ›Ή λ€μ‹λ³΄λ“
β”‚   β”β”€β”€ app.py                   # Flask μ›Ή μ„λ²„ (ν¬νΈ 8000)
β”‚   β”β”€β”€ π“‚ templates/
β”‚   β”‚   β””β”€β”€ dashboard.html       # λ©”μΈ λ€μ‹λ³΄λ“ UI
β”‚   β””β”€β”€ π“‚ static/
β”‚       β”β”€β”€ dashboard.js         # ν΄λΌμ΄μ–ΈνΈ μ‚¬μ΄λ“ JavaScript
β”‚       β””β”€β”€ dia-history.html     # λ‹¤μ΄μ•„ νμ¤ν† λ¦¬ νμ΄μ§€
β”‚
β””β”€β”€ π“‚ .git/                     # Git μ €μ¥μ†
```

---

## π”§ ν•µμ‹¬ μ»΄ν¬λ„νΈ λ¶„μ„

### 1. π–¥οΈ Server (server.py)
**μ—­ν• **: ν΄λΌμ΄μ–ΈνΈλ“¤λ΅λ¶€ν„° μƒνƒ λ°μ΄ν„°λ¥Ό μμ‹ ν•κ³  λ°μ΄ν„°λ² μ΄μ¤μ— μ €μ¥

#### μ£Όμ” ν•¨μλ“¤:
- `handle_client()`: ν΄λΌμ΄μ–ΈνΈ μ—°κ²° μ²λ¦¬ λ° JSON λ°μ΄ν„° νμ‹±
- `store_client()`: μμ‹  λ°μ΄ν„°λ¥Ό SQLite DBμ— μ €μ¥
- `watch_ahk()`: ν΄λΌμ΄μ–ΈνΈ μƒμ΅΄ κ°μ‹ (λ°±κ·ΈλΌμ΄λ“ μ¤λ λ“)
- `send_to_client()`: ν΄λΌμ΄μ–ΈνΈλ΅ λ…λ Ή μ „μ†΅ (TCP 6000 ν¬νΈ)
- `load_config()`: settings.json μ„¤μ • νμΌ λ΅λ“

#### ν¬νΈ μ„¤μ •:
- **μμ‹  ν¬νΈ**: 5050 (ν΄λΌμ΄μ–ΈνΈ β†’ μ„λ²„)
- **μ†΅μ‹  ν¬νΈ**: 6000 (μ„λ²„ β†’ ν΄λΌμ΄μ–ΈνΈ)

#### λ°μ΄ν„° μ²λ¦¬ νλ¦„:
1. ν΄λΌμ΄μ–ΈνΈλ΅λ¶€ν„° JSON λ°μ΄ν„° μμ‹ 
2. `payload` νμ‹± (name, ip, dia, game, server, msg)
3. `store_client()`λ΅ DBμ— μ €μ¥
4. λ΅κ·Έ μ¶λ ¥ λ° μƒμ΅΄ μ‹κ°„ κ°±μ‹ 

### 2. π’» Client (client.py)
**μ—­ν• **: κ²μ„ ν”„λ΅μ„Έμ¤ λ¨λ‹ν„°λ§ λ° μ„λ²„μ™€μ μ–‘λ°©ν–¥ ν†µμ‹ 

#### μ£Όμ” ν•¨μλ“¤:
- `is_target_running()`: λ€μƒ ν”„λ΅μ„Έμ¤ μ‹¤ν–‰ μƒνƒ ν™•μΈ
- `send_to_server()`: μ„λ²„λ΅ μƒνƒ λ°μ΄ν„° μ „μ†΅
- `CommandReceiver`: μ„λ²„ λ…λ Ή μμ‹  μ¤λ λ“ (ν¬νΈ 6000)
- `HttpReceiver`: AutoHotkey HTTP μ”μ²­ μμ‹  (ν¬νΈ 8123)
- `save_command_to_ini()`: μμ‹  λ…λ Ήμ„ INI νμΌλ΅ μ €μ¥
- `manage_debug_log()`: λ΅κ·Έ νμΌ ν¬κΈ°/λ‚ μ§ κ΄€λ¦¬

#### μ¤ν…”μ¤ λ¨λ“ κΈ°λ¥:
- λ€μƒ ν”„λ΅μ„Έμ¤κ°€ μ‹¤ν–‰ μ¤‘μΌ λ•λ§ λ…λ Ή μ²λ¦¬
- λ―Όκ°ν• λ…λ Ήμ–΄λ” λ³„λ„ μ²λ¦¬ (RESTART, SHUTDOWN λ“±)
- Mutexλ¥Ό ν†µν• μ¤‘λ³µ μ‹¤ν–‰ λ°©μ§€

#### ν¬νΈ μ„¤μ •:
- **λ…λ Ή μμ‹ **: 6000 (μ„λ²„ β†’ ν΄λΌμ΄μ–ΈνΈ)
- **HTTP μμ‹ **: 8123 (AutoHotkey β†’ ν΄λΌμ΄μ–ΈνΈ)
- **μ„λ²„ μ „μ†΅**: 54321 (ν΄λΌμ΄μ–ΈνΈ β†’ μ„λ²„)

### 3. π Web Dashboard (board/app.py)
**μ—­ν• **: Flask κΈ°λ° μ›Ή μΈν„°νμ΄μ¤ μ κ³µ

#### μ£Όμ” λΌμ°νΈ:
- `GET /`: λ©”μΈ λ€μ‹λ³΄λ“ νμ΄μ§€ λ λ”λ§
- `GET /api/clients`: ν΄λΌμ΄μ–ΈνΈ μƒνƒ λ°μ΄ν„° API (JSON)
- `GET /dia-history`: λ‹¤μ΄μ•„ νμ¤ν† λ¦¬ νμ΄μ§€
- `GET /api/dia-history`: λ‹¤μ΄μ•„ νμ¤ν† λ¦¬ λ°μ΄ν„° API

#### νΉμ§•:
- μ‹¤μ‹κ°„ λ°μ΄ν„° κ°±μ‹  (JavaScript fetch)
- μΉ΄λ“ κΈ°λ° UI with λ“λκ·Έ μ•¤ λ“λ΅­
- μ„λ²„λ³„/ν΄λΌμ΄μ–ΈνΈλ³„ ν•„ν„°λ§
- λ‹¤μ΄μ•„ νΈλ λ“ μ°¨νΈ κΈ°λ¥

---

## π—ƒοΈ λ°μ΄ν„°λ² μ΄μ¤ κµ¬μ΅°

### SQLite Database: `server/client_status.db`

#### ν…μ΄λΈ” 1: `clients` (μ‹¤μ‹κ°„ μƒνƒ)
```sql
CREATE TABLE clients (
    name TEXT PRIMARY KEY,      -- ν΄λΌμ΄μ–ΈνΈλ…
    ip TEXT,                    -- IP μ£Όμ†
    game TEXT,                  -- κ²μ„λ…
    server TEXT,                -- κ²μ„ μ„λ²„λ…
    dia INTEGER,                -- λ‹¤μ΄μ•„ μλ‰
    last_report TEXT,           -- λ§μ§€λ§‰ λ³΄κ³  μ‹κ°„
    status TEXT,                -- μƒνƒ (alive, offline λ“±)
    message TEXT                -- μƒνƒ λ©”μ‹μ§€
);
```

#### ν…μ΄λΈ” 2: `daily_dia` (μΌλ³„ νμ¤ν† λ¦¬)
```sql
CREATE TABLE daily_dia (
    date TEXT NOT NULL,         -- λ‚ μ§ (YYYY-MM-DD)
    name TEXT NOT NULL,         -- ν΄λΌμ΄μ–ΈνΈλ…
    ip TEXT,                    -- IP μ£Όμ†
    game TEXT,                  -- κ²μ„λ…
    server TEXT,                -- κ²μ„ μ„λ²„λ…
    dia INTEGER,                -- λ‹¤μ΄μ•„ μλ‰
    status TEXT,                -- μƒνƒ
    message TEXT,               -- λ©”μ‹μ§€
    PRIMARY KEY (date, name)    -- λ³µν•© κΈ°λ³Έν‚¤
);
```

---

## π”„ μ‹μ¤ν… μ›ν¬ν”λ΅μ°

### 1. μΌλ°μ μΈ λ°μ΄ν„° μμ§‘ νλ¦„
```mermaid
graph TD
    A[AutoHotkey Script] --> B[HTTP Request :8123]
    B --> C[Client.py HttpReceiver]
    C --> D[JSON Payload μƒμ„±]
    D --> E[Server.py :5050]
    E --> F[handle_client ν•¨μ]
    F --> G[store_client ν•¨μ]
    G --> H[SQLite DB μ €μ¥]
    H --> I[Web Dashboard μ΅°ν]
```

### 2. λ…λ Ή μ „μ†΅ νλ¦„
```mermaid
graph TD
    A[μ„λ²„ κ΄€λ¦¬μ] --> B[Server.py send_to_client]
    B --> C[TCP :6000]
    C --> D[Client.py CommandReceiver]
    D --> E[λ€μƒ ν”„λ΅μ„Έμ¤ ν™•μΈ]
    E --> F[INI νμΌ μ €μ¥]
    F --> G[AutoHotkey μ¤ν¬λ¦½νΈ]
```

### 3. μ›Ή λ€μ‹λ³΄λ“ λ°μ΄ν„° νλ¦„
```mermaid
graph TD
    A[λΈλΌμ°μ €] --> B[dashboard.js fetchClients]
    B --> C[GET /api/clients]
    C --> D[app.py api_clients]
    D --> E[SQLite μΏΌλ¦¬]
    E --> F[JSON μ‘λ‹µ]
    F --> G[μΉ΄λ“ UI μ—…λ°μ΄νΈ]
```

---

## π”— μ»΄ν¬λ„νΈ κ΄€κ³„λ„

```
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”    HTTP :8123     β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚  AutoHotkey     β”‚ β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€> β”‚   Client.py     β”‚
β”‚  Scripts        β”‚                    β”‚  (κ° VMλ³„)      β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”                    β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                                              β”‚
                                              β”‚ TCP :5050
                                              β”‚ (μƒνƒ μ „μ†΅)
                                              β–Ό
                                       β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                                       β”‚   Server.py     β”‚
                                       β”‚  (μ¤‘μ•™ μ„λ²„)    β”‚
                                       β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                                              β”‚
                                              β”‚ SQLite
                                              β–Ό
                                       β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                                       β”‚ client_status.dbβ”‚
                                       β”‚ β”β”€ clients     β”‚
                                       β”‚ β””β”€ daily_dia   β”‚
                                       β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                                              β”‚
                                              β”‚ Query
                                              β–Ό
                                       β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                                       β”‚   Flask App     β”‚
                                       β”‚  (board/app.py) β”‚
                                       β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                                              β”‚
                                              β”‚ HTTP :8000
                                              β–Ό
                                       β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                                       β”‚  Web Browser    β”‚
                                       β”‚   Dashboard     β”‚
                                       β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

---

## β οΈ ν„μ¬ λ¬Έμ μ  λ° κ°μ„ μ‚¬ν•­

### π› λ°κ²¬λ λ¬Έμ μ λ“¤

#### 1. ν¬νΈ μ„¤μ • λ¶μΌμΉ
- **client/config.json**: `send_port: 54321, recv_port: 6000`
- **server/settings.json**: `server_port: 54321`
- **server.py μ½”λ“**: μ‹¤μ λ΅λ” `5050` ν¬νΈ μ‚¬μ©
- **ν•΄κ²°λ°©μ•**: μ„¤μ • νμΌκ³Ό μ‹¤μ  μ½”λ“μ ν¬νΈ λ²νΈ ν†µμΌ ν•„μ”

#### 2. μ¤‘λ³µ ν΄λ” κµ¬μ΅°
- `server_client_project/`μ™€ `server_client_project1/` λ™μ‹ μ΅΄μ¬
- κ°λ° μ¤‘ νΌλ€ μ•ΌκΈ° κ°€λ¥
- **ν•΄κ²°λ°©μ•**: μ‚¬μ©ν•μ§€ μ•λ” ν΄λ” μ •λ¦¬ λλ” λ…ν™•ν• μ—­ν•  κµ¬λ¶„

#### 3. ν•λ“μ½”λ”©λ μ„¤μ •κ°’
- client.pyμ—μ„ μΌλ¶€ ν¬νΈ λ²νΈκ°€ ν•λ“μ½”λ”©λ¨
- IP μ£Όμ†κ°€ μ„¤μ • νμΌκ³Ό μ½”λ“μ— λ¶„μ‚°
- **ν•΄κ²°λ°©μ•**: λ¨λ“  μ„¤μ •μ„ config νμΌλ΅ ν†µμΌ

#### 4. μ¤λ¥ μ²λ¦¬ λ¶€μ΅±
- λ„¤νΈμ›ν¬ λ‹¨μ  μ‹ μ¬μ—°κ²° λ΅μ§ μ—†μ
- λ°μ΄ν„°λ² μ΄μ¤ λ½ μƒν™© μ²λ¦¬ λ―Έν΅
- **ν•΄κ²°λ°©μ•**: Robustν• μμ™Έ μ²λ¦¬ λ° μ¬μ—°κ²° λ©”μ»¤λ‹μ¦ μ¶”κ°€

### π”§ κ¶μ¥ κ°μ„ μ‚¬ν•­

#### 1. λ³΄μ• κ°•ν™”
- ν„μ¬ ν‰λ¬Έ ν†µμ‹  β†’ TLS/SSL μ•”νΈν™” μ μ©
- μΈμ¦ λ©”μ»¤λ‹μ¦ μ¶”κ°€ (API ν‚¤, JWT λ“±)
- μ›Ή λ€μ‹λ³΄λ“ μ ‘κ·Ό κ¶ν• μ μ–΄

#### 2. λ¨λ‹ν„°λ§ κ°•ν™”
- Health check μ—”λ“ν¬μΈνΈ μ¶”κ°€
- μ•λ¦Ό μ‹μ¤ν… κµ¬μ¶• (μ΄λ©”μΌ, Slack λ“±)
- λ” μƒμ„Έν• λ΅κ·Έ λ λ²¨ κµ¬λ¶„

#### 3. μ„±λ¥ μµμ ν™”
- λ°μ΄ν„°λ² μ΄μ¤ μΈλ±μ¤ μµμ ν™”
- μ›Ή λ€μ‹λ³΄λ“ μ‹¤μ‹κ°„ μ—…λ°μ΄νΈ (WebSocket)
- λ€μ©λ‰ λ°μ΄ν„° μ²λ¦¬λ¥Ό μ„ν• νμ΄μ§€λ„¤μ΄μ…

#### 4. μ΄μ νΈμμ„±
- Docker μ»¨ν…μ΄λ„ν™”
- systemd μ„λΉ„μ¤ λ“±λ΅ μ¤ν¬λ¦½νΈ
- λ°±μ—…/λ³µμ› μλ™ν™” μ¤ν¬λ¦½νΈ
- μ„¤μ • νμΌ κ²€μ¦ λ„κµ¬

---

## π“ μ‚¬μ©λ²• μ”μ•½

### μ‹μ¤ν… μ‹μ‘ μμ„
1. **μ„λ²„ μ‹μ‘**: `python server/server.py` (ν¬νΈ 5050 λ€κΈ°)
2. **μ›Ή λ€μ‹λ³΄λ“ μ‹μ‘**: `python board/app.py` (ν¬νΈ 8000 λ€κΈ°)
3. **ν΄λΌμ΄μ–ΈνΈ μ‹μ‘**: `python client/client.py` (κ° VMμ—μ„)

### μ£Όμ” URL
- **λ©”μΈ λ€μ‹λ³΄λ“**: `http://localhost:8000/`
- **λ‹¤μ΄μ•„ νμ¤ν† λ¦¬**: `http://localhost:8000/dia-history`
- **API μ—”λ“ν¬μΈνΈ**: `http://localhost:8000/api/clients`

### μ„¤μ • νμΌ μ„μΉ
- μ„λ²„: `server/settings.json`
- ν΄λΌμ΄μ–ΈνΈ: `client/config.json`
- λ°μ΄ν„°λ² μ΄μ¤: `server/client_status.db`

---

**π“… λ¬Έμ„ μ‘μ„±μΌ**: 2025-01-14
**π”„ λ§μ§€λ§‰ μ—…λ°μ΄νΈ**: ν”„λ΅μ νΈ v2.3.6-stealth κΈ°μ¤€
**π‘¤ λ¶„μ„μ**: Claude Code Assistant